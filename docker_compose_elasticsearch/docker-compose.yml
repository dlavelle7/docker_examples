version: "2.3"
services:
  web:
    build: ./web/  # use Dockerfile from directory
    env_file: search_engine.env
    networks:
      - country_search
    ports:
      # expose port 80 to host machine and target container port 8000 where
      # wsgi http server is running on (web server ommitted for berivity)
      - "80:8000"
    container_name: web
    # wait for ES to be ready and run web app
    entrypoint: /web/entrypoint
    depends_on:
      - elastic
  elastic:
    # TODO: use data volume to persist search engine data
    image: docker.elastic.co/elasticsearch/elasticsearch:6.6.0
    environment:
      - discovery.type=single-node
    networks:
      - country_search
  kibana:
    image: docker.elastic.co/kibana/kibana:6.6.0
    environment:
      SERVER_NAME: kibana
      ELASTICSEARCH_HOSTS: http://elastic
    networks:
      - country_search
    ports:
      - "5601:5601"
    depends_on:
      - elastic
volumes:
  # volume for search engine data persistence
  data:
networks:
  country_search:
